CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "Publishers" (
    "PublisherId" bigint GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NULL,
    CONSTRAINT "PK_Publishers" PRIMARY KEY ("PublisherId")
);

CREATE TABLE "Words" (
    "Literal" text NOT NULL,
    CONSTRAINT "PK_Words" PRIMARY KEY ("Literal")
);

CREATE TABLE "Articles" (
    "ArticleId" bigint NOT NULL,
    "Title" text NULL,
    "FilePath" text NULL,
    "TotalWordsInArticle" integer NOT NULL,
    "Name" bigint NULL,
    CONSTRAINT "PK_Articles" PRIMARY KEY ("ArticleId"),
    CONSTRAINT "FK_Articles_Publishers_ArticleId" FOREIGN KEY ("ArticleId") REFERENCES "Publishers" ("PublisherId") ON DELETE CASCADE,
    CONSTRAINT "FK_Articles_Publishers_Name" FOREIGN KEY ("Name") REFERENCES "Publishers" ("PublisherId") ON DELETE RESTRICT
);

CREATE TABLE "WordOccurances" (
    "Id" bigint GENERATED BY DEFAULT AS IDENTITY,
    "ArticleId" bigint NULL,
    "Occurances" integer NOT NULL,
    CONSTRAINT "PK_WordOccurances" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_WordOccurances_Articles_ArticleId" FOREIGN KEY ("ArticleId") REFERENCES "Articles" ("ArticleId") ON DELETE RESTRICT
);

CREATE TABLE "OccursInWord" (
    "OccursInId" bigint NOT NULL,
    "WordsLiteral" text NOT NULL,
    CONSTRAINT "PK_OccursInWord" PRIMARY KEY ("OccursInId", "WordsLiteral"),
    CONSTRAINT "FK_OccursInWord_WordOccurances_OccursInId" FOREIGN KEY ("OccursInId") REFERENCES "WordOccurances" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_OccursInWord_Words_WordsLiteral" FOREIGN KEY ("WordsLiteral") REFERENCES "Words" ("Literal") ON DELETE CASCADE
);

CREATE INDEX "IX_Articles_Name" ON "Articles" ("Name");

CREATE INDEX "IX_OccursInWord_WordsLiteral" ON "OccursInWord" ("WordsLiteral");

CREATE INDEX "IX_WordOccurances_ArticleId" ON "WordOccurances" ("ArticleId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20211022125909_initial', '5.0.10');

COMMIT;
